{{ define "post" }}
    {{ $global := . }}
    <main>
        <article class="object parent" id="post">
            <div class="object-header">
                <div class="mol">
                    <div>
                        <a><b>Published At:</b></a>
                        <a class="date">{{ .post.CreatedAt }}</a>
                    </div>
                </div>
                {{ if eq .user.Role "admin" }}
                <div class="object-actions">
                    <a href="/workshop/post/{{ .post.ID }}">‚úèÔ∏è</a>
                    <a id="delete" data-post-id="{{ .post.ID }}" class="delete">‚ùå</a>
                </div>
                {{ end }}
            </div>

            <div class="object-content">
                <p>{{ .post.Content }}</p>
        
                {{ if ne .post.AttachmentType "none"}}
        
                    {{ if eq .post.AttachmentType "image" }}
                        <div class="post-attachment image">
                            <img class="illustration" src="/uploads/{{ .post.Attachment.ImageFilename }}" />
                        </div>
                    {{end}}
        
                    {{ if eq .post.AttachmentType "carousel" }}
                        <div class="post-attachment carousel" id="carousel">
                            {{ range .post.Attachment.ImagesFilenames}}
                                <div class="carousel-item">
                                    <img src="/uploads/{{ . }}" />
                                </div>
                            {{ end }}
                        </div>
                    {{end}}
        
                    {{ if eq .post.AttachmentType "youtube" }}
                        <a class="post-attachment link" href="https://youtu.be/{{ .post.Attachment.VideoId }}" target="_blank">
                            <div class="link-thumbnail">
                                <img src="https://i.ytimg.com/vi/{{ .post.Attachment.VideoId }}/mqdefault.jpg"/>
                            </div>
                            <div class="link-meta">
                                <h3 class="link-title">{{ .post.Attachment.Title }}</h3>
                                <p class="link-description">{{ .post.Attachment.Description }}</p>
                            </div>
                        </a>
                    {{end}}
        
                {{ end }}
            </div>
      
    
            <div class="object-footer">
                <div class="mol">
                    <a class="counter comments">üí¨ {{ .post.NumOfComments }}</a>
                    {{ if .post.IsLiked }}
                        <a class="counter like" data-post-id="{{ .post.ID }}" data-is-checked="true">‚ù§Ô∏è {{ .post.NumOfLikes }}</a>
                    {{ else }}
                        <a class="counter like" data-post-id="{{ .post.ID }}">ü©∂ {{ .post.NumOfLikes }}</a>
                    {{ end }}
                </div>  
            </div>  
        </article>
    </main>

    <section>
        <div class="section-header">
            <h2> Comments </h2>
            {{ if .user.Id }}
            <div><a class="btn" href="/workshop/comment?post_id={{ .post.ID }}">Add a comment</a></div>
            {{ end }}
        </div>

        {{range .comments }}
            <article class="object comment">
                <div class="object-header">
                    <div class="mol h">
                        <div class="author">
                            <img src="/static/img/{{.CommentatorAvatar}}">
                            <a>{{ .CommentatorUsername }}</a>
                        </div>
                        <div>
                            <a>at:</a><a class="date">{{ .CreatedAt }}</a>
                        </div>
                    </div>
                    <div class="object-actions">
                        <a href="/comment/{{.ID}}">üëÅÔ∏è</a>
                    </div>
                </div>

                <div class="object-content">
                    <p>{{ .Content }}</p>
                </div>
                
                <div class="object-footer">
                    <div class="mol">
                        <a class="counter comments" href="/comment/{{.ID}}">üí¨ {{ .NumOfReplies }}</a>
                    </div>    
                </div>
            </article>    
        {{ else }}
            <p>No comments yet.</p>
        {{ end }}
    </section>
{{ end }}

{{define "post_workshop"}}
    <form class="workshop" id="workshop" {{ if .content }} data-post-id="{{ .content.ID }}" {{ end }} >
        <label for="content">Type post text here:</label>
        <textarea id="content" name="content" rows="12" placeholder="Type here..." required>{{ if .content }}{{ .content.Content }}{{ end }}</textarea>
        {{ if .content }}
        {{ else }}
        <label for="attachment-type"> Select an attachement type: </label>
        <select name="attachment-type" id="attachement-type">
            <option value="none">None</option>
            <option value="image">Image</option>
            <option value="carousel">Carousel</option>
            <option value="youtube">Youtube Video</option>
        </select>
        {{ end }}
        <input class="btn" type="submit" value="Submit" />
    </form>
{{end}}
